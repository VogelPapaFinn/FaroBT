DROP TABLE account CASCADE;
DROP TABLE ticket CASCADE;
DROP TABLE role CASCADE;
DROP TABLE permission CASCADE;
DROP TABLE comment CASCADE;
DROP TABLE file CASCADE;

CREATE TABLE "account"(
	account_id UUID DEFAULT uuid_generate_v4(),
	first_name VARCHAR(50),
	last_name VARCHAR(50),
	account_name VARCHAR(50) NOT NULL,
	password VARCHAR(200) NOT NULL,
	location VARCHAR(50),
	birth DATE,	
	mail VARCHAR(50),
	phone VARCHAR(50),
	created DATE NOT NULL DEFAULT CURRENT_DATE,
	PRIMARY KEY(account_id)
);

CREATE TABLE  "ticket" (
	ticket_id UUID DEFAULT uuid_generate_v4(),
	account_id UUID NOT NULL,
	titel VARCHAR(200) NOT NULL,
	description TEXT NOT NULL,
	worker_id UUID NOT NULL,
	type VARCHAR(50) NOT NULL,
	rank INT NOT NULL,
	status VARCHAR(50) NOT NULL,
	created DATE NOT NULL DEFAULT CURRENT_DATE,
	closed DATE,
	PRIMARY KEY (ticket_id),
	CONSTRAINT fk_account FOREIGN KEY(account_id) REFERENCES "account"(account_id),
	CONSTRAINT fk_worker FOREIGN KEY(worker_id) REFERENCES "account"(account_id)
);

CREATE TABLE  "role" (
	role_id UUID DEFAULT uuid_generate_v4(),
	account_id UUID NOT NULL,
	PRIMARY KEY(role_id),
	CONSTRAINT fk_account FOREIGN KEY(account_id) REFERENCES "account"(account_id)
);

CREATE TABLE  "permission" (
	role_id UUID DEFAULT uuid_generate_v4(),
	permission VARCHAR(50) NOT NULL,
	PRIMARY KEY(permission),
	CONSTRAINT fk_role FOREIGN KEY(role_id) REFERENCES "role"(role_id)
);

CREATE TABLE  "comment" (
	comment_id UUID DEFAULT uuid_generate_v4(),
	ticket_id UUID NOT NULL,
	account_id UUID NOT NULL,
	created DATE NOT NULL DEFAULT CURRENT_DATE,
	time TIME NOT NULL DEFAULT CURRENT_TIME,
	type VARCHAR(50) NOT NULL,
	message VARCHAR(1024),
	PRIMARY KEY(comment_id),
	CONSTRAINT fk_ticket FOREIGN KEY(ticket_id) REFERENCES "ticket"(ticket_id),
	CONSTRAINT fk_account FOREIGN KEY(account_id) REFERENCES "account"(account_id)
);

CREATE TABLE  "file" (
	file_id UUID DEFAULT uuid_generate_v4(),
	ticket_id UUID NOT NULL,
	comment_id UUID NOT NULL,
	file_type VARCHAR(50) NOT NULL,
	directory VARCHAR(200) NOT NULL,
	PRIMARY KEY(file_id),
	CONSTRAINT fk_ticket FOREIGN KEY(ticket_id) REFERENCES "ticket"(ticket_id),
	CONSTRAINT fk_comment FOREIGN KEY(comment_id) REFERENCES "comment"(comment_id)
);